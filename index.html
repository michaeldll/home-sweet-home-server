<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>Home sweet Home - Websockets Server</title>
		<style>
			p.small {
				font-size: 0.8rem;
			}
			p.bold {
				font-weight: bold;
			}
		</style>
	</head>

	<body>
		<p>Client time :</p>

		<div id="client-time">waiting for javascript</div>

		<p>Server time :</p>

		<div id="server-time">waiting for connection</div>

		<p>Device X (beta):</p>
		<p class="small">
			Represents the motion of the device around the x axis. Represented in degrees with values ranging from -180
			to 180. This represents a front to back motion of the device.
		</p>
		<p class="small bold">
			Only works on devices emitting the "deviceorientation" event. E.g smartphones
		</p>

		<div id="device-beta">waiting for device event</div>

		<p>Server X (beta:</p>

		<div id="server-beta">waiting for connection</div>

		<script>
			/**
			 * Client Time
			 */
			const getClientTime = now => {
				const hours = now.getHours();
				const minutes = now.getMinutes();
				const seconds = now.getSeconds();
				const milliseconds = now.getMilliseconds();

				const dateString = `${hours}:${minutes}:${seconds}:${milliseconds}`;

				return dateString;
			};

			setInterval(() => {
				document.querySelector('#client-time').innerText = getClientTime(new Date());
			}, 1);

			/**
			 * Device orientation
			 */

			const handleOrientation = e => {
				/*
					Absolute is true if the orientation data in instanceOfDeviceOrientationEvent is provided as the difference between the Earth's coordinate frame and the device's coordinate frame, or false if the orientation data is being provided in reference to some arbitrary, device-determined coordinate frame.
				*/
				// const absolute = event.absolute;
				/*
					Alpha: represents the motion of the device around the z axis.
					Represented in degrees with values ranging from 0 to 360.
				*/
				// const alpha = event.alpha;
				/*
					Beta: represents the motion of the device around the x axis. 
					Represented in degrees with values ranging from -180 to 180. 
					This represents a front to back motion of the device.
				*/
				const beta = event.beta;
				/*
					Gamma: represents the motion of the device around the y axis. 
					Represented in degrees with values ranging from -90 to 90. 
					This represents a left to right motion of the device.
				*/
				// const gamma = event.gamma;

				const setBetaNode = b => {
					const betaNode = document.querySelector('#device-beta');
					betaNode.innerHTML = b;
				};

				setBetaNode(beta);
			};

			window.addEventListener('deviceorientation', handleOrientation, true);

			/**
			 * Websockets
			 */
			const HOST = location.origin.replace(/^http/, 'ws');
			const ws = new WebSocket(HOST);
			let el;

			const setDOMServerTime = value => {
				el = document.querySelector('#server-time');
				el.innerHTML = value;
			};

			ws.onmessage = event => {
				const data = JSON.parse(event.data);

				switch (data.type) {
					case 'date':
						setDOMServerTime(data.message);
						break;

					default:
						break;
				}
			};
		</script>
	</body>
</html>
